<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Test - Unencrypted Playback</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.9.3/shaka-player.compiled.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        .content {
            padding: 20px;
        }
        .video-container {
            margin: 20px 0;
            text-align: center;
        }
        video {
            width: 100%;
            max-width: 800px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        button {
            background: #4caf50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .info-panel {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.loading {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .explanation {
            background: #e8f5e8;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 20px 0;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 10px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        .test-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .test-card {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        .test-card.active {
            border-color: #4caf50;
            background: #f8fff8;
        }
        @media (max-width: 768px) {
            .test-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé¨ Video Test Environment</h1>
            <p>Test Unencrypted vs Encrypted Video Playback</p>
        </div>
        
        <div class="content">
            <div class="explanation">
                <h3>üß™ Video Testing</h3>
                <p>This page allows you to test both unencrypted and encrypted video playback:</p>
                <ul>
                    <li>‚úÖ <strong>Unencrypted</strong>: Direct MP4 playback (no encryption)</li>
                    <li>üîê <strong>Encrypted</strong>: DASH manifest with ClearKey decryption</li>
                </ul>
                <p>Start with unencrypted to verify basic video playback works!</p>
            </div>

            <div class="test-options">
                <div class="test-card" id="unencryptedCard">
                    <h3>üìπ Unencrypted Video</h3>
                    <p>Direct MP4 playback</p>
                    <button onclick="loadUnencryptedVideo()">üé¨ Load Original Video</button>
                </div>
                <div class="test-card" id="encryptedCard">
                    <h3>üîê Encrypted Video</h3>
                    <p>DASH + ClearKey</p>
                    <button onclick="loadEncryptedVideo()">üîë Load Encrypted Video</button>
                </div>
            </div>

            <div class="video-container">
                <video id="video" controls poster="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjQ1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtc2l6ZT0iMjQiIGZpbGw9IiM5OTkiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5WaWRlbyBUZXN0IFBsYXllcjwvdGV4dD48L3N2Zz4=">
                    Your browser does not support the video tag.
                </video>
            </div>

            <div class="controls">
                <button onclick="testVideoElement()">üîß Test HTML5 Video</button>
                <button onclick="testShakaPlayer()">üéØ Test Shaka Player</button>
                <button onclick="clearPlayer()">üóëÔ∏è Clear Player</button>
                <button onclick="checkVideoFile()">üìÇ Check Video File</button>
            </div>

            <div id="status" class="status" style="display: none;"></div>

            <div class="info-panel">
                <h3>üìã Current Test</h3>
                <p><strong>Mode:</strong> <span id="currentMode">None</span></p>
                <p><strong>Source:</strong> <span id="currentSource">None</span></p>
                <p><strong>Player:</strong> <span id="currentPlayer">None</span></p>
            </div>

            <div class="info-panel">
                <h3>üìù Test Log</h3>
                <div id="eventLog" class="log"></div>
            </div>

            <div class="explanation">
                <h3>üîß Available Test Files</h3>
                <ul>
                    <li><strong>Unencrypted:</strong> <code>http://localhost:8080/content/input.mp4</code></li>
                    <li><strong>Encrypted DASH:</strong> <code>http://localhost:8080/manifest.mpd</code></li>
                    <li><strong>Encrypted Video:</strong> <code>http://localhost:8080/video_encrypted.mp4</code></li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let player = null;
        let currentTest = null;

        // Logging function
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('eventLog');
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
            logElement.textContent += logEntry;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(logEntry.trim());
        }

        // Status display function
        function showStatus(message, type = 'loading') {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
            statusElement.style.display = 'block';
            
            if (type === 'success' || type === 'error') {
                setTimeout(() => {
                    statusElement.style.display = 'none';
                }, 5000);
            }
        }

        // Update current test info
        function updateTestInfo(mode, source, playerType) {
            document.getElementById('currentMode').textContent = mode;
            document.getElementById('currentSource').textContent = source;
            document.getElementById('currentPlayer').textContent = playerType;
            
            // Update card highlights
            document.querySelectorAll('.test-card').forEach(card => card.classList.remove('active'));
            if (mode === 'Unencrypted') {
                document.getElementById('unencryptedCard').classList.add('active');
            } else if (mode === 'Encrypted') {
                document.getElementById('encryptedCard').classList.add('active');
            }
        }

        // Initialize Shaka Player
        async function initShakaPlayer() {
            try {
                if (player) {
                    await player.destroy();
                }
                
                log('Initializing Shaka Player...');
                shaka.polyfill.installAll();
                
                if (!shaka.Player.isBrowserSupported()) {
                    throw new Error('Browser does not support Shaka Player');
                }
                
                const video = document.getElementById('video');
                player = new shaka.Player(video);
                
                player.addEventListener('error', (event) => {
                    const error = event.detail;
                    log(`Shaka Player error: ${error.message}`, 'error');
                    showStatus(`Player error: ${error.message}`, 'error');
                });
                
                log('Shaka Player initialized successfully');
                return player;
            } catch (error) {
                log(`Failed to initialize Shaka Player: ${error.message}`, 'error');
                throw error;
            }
        }

        // Test unencrypted video
        async function loadUnencryptedVideo() {
            try {
                showStatus('Loading unencrypted video...', 'loading');
                log('Testing unencrypted video playback');
                
                await initShakaPlayer();
                
                const videoUrl = 'http://localhost:8080/content/input.mp4';
                log(`Loading: ${videoUrl}`);
                
                // No DRM configuration needed for unencrypted content
                await player.load(videoUrl);
                
                updateTestInfo('Unencrypted', 'content/input.mp4', 'Shaka Player');
                log('‚úÖ Unencrypted video loaded successfully!');
                showStatus('‚úÖ Unencrypted video ready! This proves basic playback works.', 'success');
                
            } catch (error) {
                log(`Failed to load unencrypted video: ${error.message}`, 'error');
                showStatus(`Failed to load unencrypted video: ${error.message}`, 'error');
            }
        }

        // Test encrypted video
        async function loadEncryptedVideo() {
            try {
                showStatus('Loading encrypted video...', 'loading');
                log('Testing encrypted video playback');
                
                await initShakaPlayer();
                
                // Load player configuration with detailed logging
                log('Step 1: Loading player configuration...');
                const configResponse = await fetch('/player-config.json');
                if (!configResponse.ok) {
                    throw new Error(`Config request failed: ${configResponse.status} ${configResponse.statusText}`);
                }
                const config = await configResponse.json();
                log(`‚úÖ Config loaded: ${JSON.stringify(config, null, 2)}`);
                
                // Validate configuration
                if (!config.clearKeys || Object.keys(config.clearKeys).length === 0) {
                    throw new Error('No clearKeys found in configuration');
                }
                
                const keyCount = Object.keys(config.clearKeys).length;
                log(`Step 2: Found ${keyCount} encryption key(s)`);
                
                // Log each key pair
                for (const [kid, key] of Object.entries(config.clearKeys)) {
                    log(`  Key ID: ${kid}`);
                    log(`  Key: ${key}`);
                    log(`  Key ID length: ${kid.length} chars`);
                    log(`  Key length: ${key.length} chars`);
                    
                    // Validate key formats
                    const kidValid = /^[0-9a-f]{32}$/i.test(kid);
                    const keyValid = /^[0-9a-f]{32}$/i.test(key);
                    log(`  Key ID format valid: ${kidValid}`);
                    log(`  Key format valid: ${keyValid}`);
                }
                
                log('Step 3: Configuring ClearKey encryption...');
                player.configure({
                    drm: {
                        clearKeys: config.clearKeys
                    }
                });
                log(`‚úÖ ClearKey configured with ${keyCount} key(s)`);
                
                // Test manifest accessibility first
                log('Step 4: Testing manifest accessibility...');
                const manifestUrl = config.manifestUrl;
                log(`Manifest URL: ${manifestUrl}`);
                
                const manifestResponse = await fetch(manifestUrl);
                if (!manifestResponse.ok) {
                    throw new Error(`Manifest request failed: ${manifestResponse.status} ${manifestResponse.statusText}`);
                }
                
                const manifestText = await manifestResponse.text();
                log(`‚úÖ Manifest accessible, size: ${manifestText.length} bytes`);
                log(`Manifest content type: ${manifestResponse.headers.get('content-type')}`);
                
                // Check manifest content for key issues
                if (manifestText.includes('cenc:default_KID')) {
                    const kidMatch = manifestText.match(/cenc:default_KID="([^"]+)"/);
                    if (kidMatch) {
                        const manifestKid = kidMatch[1];
                        log(`Manifest KID: ${manifestKid}`);
                        
                        // Check if KID formats match
                        const normalizedManifestKid = manifestKid.replace(/-/g, '');
                        const configKids = Object.keys(config.clearKeys);
                        const kidMatches = configKids.some(configKid => 
                            configKid.toLowerCase() === normalizedManifestKid.toLowerCase()
                        );
                        log(`KID format match: ${kidMatches}`);
                        
                        if (!kidMatches) {
                            log('‚ö†Ô∏è  WARNING: Manifest KID does not match any config KID', 'error');
                            log(`  Manifest KID (normalized): ${normalizedManifestKid}`);
                            log(`  Config KIDs: ${configKids.join(', ')}`);
                        }
                    }
                }
                
                // Check for ClearKey UUID
                if (manifestText.includes('urn:uuid:e2719d58-a985-b3c9-781a-b030af78d30e')) {
                    log('‚úÖ Manifest contains ClearKey UUID');
                } else if (manifestText.includes('urn:uuid:')) {
                    const uuidMatch = manifestText.match(/urn:uuid:([a-f0-9-]+)/);
                    if (uuidMatch) {
                        log(`‚ö†Ô∏è  WARNING: Manifest contains different UUID: ${uuidMatch[1]}`, 'error');
                        log('  Expected ClearKey UUID: e2719d58-a985-b3c9-781a-b030af78d30e');
                    }
                } else {
                    log('‚ö†Ô∏è  WARNING: No DRM UUID found in manifest', 'error');
                }
                
                // Add more detailed error handling
                player.addEventListener('error', (event) => {
                    const error = event.detail;
                    log(`üî• Shaka Player Error Details:`, 'error');
                    log(`  Code: ${error.code}`, 'error');
                    log(`  Category: ${error.category}`, 'error');
                    log(`  Severity: ${error.severity}`, 'error');
                    log(`  Message: ${error.message}`, 'error');
                    log(`  Data: ${JSON.stringify(error.data)}`, 'error');
                    
                    // Specific error code explanations
                    if (error.code === 3004) {
                        log('üîç Error 3004 Analysis:', 'error');
                        log('  This indicates a DRM configuration or manifest parsing issue', 'error');
                        log('  Common causes:', 'error');
                        log('    - Wrong DRM scheme UUID in manifest', 'error');
                        log('    - Malformed manifest XML', 'error');
                        log('    - Missing or invalid PSSH box', 'error');
                        log('    - Incompatible protection scheme', 'error');
                    }
                });
                
                log('Step 5: Loading encrypted manifest...');
                
                // Clear any previous error handlers to avoid conflicts
                player.removeEventListener('error');
                
                // Set up error monitoring
                player.addEventListener('error', (event) => {
                    const error = event.detail;
                    log(`üö® Shaka Error Details:`, 'error');
                    log(`  - Code: ${error.code}`, 'error');
                    log(`  - Category: ${error.category}`, 'error');
                    log(`  - Severity: ${error.severity}`, 'error');
                    log(`  - Message: ${error.message}`, 'error');
                    if (error.data) {
                        log(`  - Data: ${JSON.stringify(error.data)}`, 'error');
                    }
                });
                
                // Check if browser supports the required capabilities
                log('üîç Checking browser EME capabilities...');
                if ('requestMediaKeySystemAccess' in navigator) {
                    try {
                        // Test basic ClearKey support
                        const keySystemConfig = [{
                            initDataTypes: ['cenc', 'webm'],
                            audioCapabilities: [
                                {contentType: 'audio/mp4; codecs="mp4a.40.2"'},
                                {contentType: 'audio/webm; codecs="opus"'}
                            ],
                            videoCapabilities: [
                                {contentType: 'video/mp4; codecs="avc1.640033"'},
                                {contentType: 'video/mp4; codecs="avc1.42E01E"'},
                                {contentType: 'video/webm; codecs="vp9"'}
                            ]
                        }];
                        
                        const access = await navigator.requestMediaKeySystemAccess('org.w3.clearkey', keySystemConfig);
                        log('‚úÖ ClearKey system access confirmed');
                        
                    } catch (keySystemError) {
                        log(`‚ùå ClearKey not supported: ${keySystemError.message}`, 'error');
                        log('üîß Trying alternative key system configurations...', 'error');
                        
                        // Try simpler config
                        try {
                            const simpleConfig = [{
                                initDataTypes: ['cenc']
                            }];
                            await navigator.requestMediaKeySystemAccess('org.w3.clearkey', simpleConfig);
                            log('‚úÖ Basic ClearKey support confirmed');
                        } catch (simpleError) {
                            log(`‚ùå No ClearKey support: ${simpleError.message}`, 'error');
                        }
                    }
                } else {
                    log('‚ùå EME not supported in this browser', 'error');
                }
                
                log('üé¨ Attempting to load manifest with Shaka Player...');
                await player.load(manifestUrl);
                
                updateTestInfo('Encrypted', 'manifest.mpd', 'Shaka Player + ClearKey');
                log('‚úÖ Encrypted video loaded successfully!');
                showStatus('‚úÖ Encrypted video ready! Encryption pipeline working.', 'success');
                
            } catch (error) {
                log(`‚ùå Failed to load encrypted video: ${error.message}`, 'error');
                log(`Error stack: ${error.stack}`, 'error');
                
                // Additional context for common issues
                if (error.message.includes('3004')) {
                    log('üîß Troubleshooting suggestions:', 'error');
                    log('  1. Check manifest DRM UUID (should be ClearKey UUID)', 'error');
                    log('  2. Verify KID format consistency (no dashes)', 'error');
                    log('  3. Ensure manifest is valid XML', 'error');
                    log('  4. Check browser EME support', 'error');
                }
                
                showStatus(`Failed to load encrypted video: ${error.message}`, 'error');
            }
        }

        // Test with native HTML5 video element
        async function testVideoElement() {
            try {
                showStatus('Testing HTML5 video element...', 'loading');
                log('Testing native HTML5 video playback');
                
                if (player) {
                    await player.destroy();
                    player = null;
                }
                
                const video = document.getElementById('video');
                video.src = 'http://localhost:8080/content/input.mp4';
                
                video.addEventListener('loadeddata', () => {
                    log('‚úÖ HTML5 video loaded successfully');
                    showStatus('‚úÖ HTML5 video works! Browser can play MP4 files.', 'success');
                });
                
                video.addEventListener('error', (e) => {
                    log(`HTML5 video error: ${e.message}`, 'error');
                    showStatus('‚ùå HTML5 video failed', 'error');
                });
                
                updateTestInfo('Unencrypted', 'content/input.mp4', 'HTML5 Video');
                log('HTML5 video element configured');
                
            } catch (error) {
                log(`HTML5 video test failed: ${error.message}`, 'error');
                showStatus(`HTML5 video test failed: ${error.message}`, 'error');
            }
        }

        // Test Shaka Player without encryption
        async function testShakaPlayer() {
            try {
                showStatus('Testing Shaka Player capabilities...', 'loading');
                log('Testing Shaka Player without encryption');
                
                await initShakaPlayer();
                
                // Test with unencrypted content first
                await player.load('http://localhost:8080/content/input.mp4');
                
                updateTestInfo('Unencrypted', 'content/input.mp4', 'Shaka Player');
                log('‚úÖ Shaka Player working with unencrypted content');
                showStatus('‚úÖ Shaka Player works! Ready for encrypted content.', 'success');
                
            } catch (error) {
                log(`Shaka Player test failed: ${error.message}`, 'error');
                showStatus(`Shaka Player test failed: ${error.message}`, 'error');
            }
        }

        // Clear player
        async function clearPlayer() {
            try {
                const video = document.getElementById('video');
                
                if (player) {
                    await player.destroy();
                    player = null;
                }
                
                video.removeAttribute('src');
                video.load(); // Reset video element
                
                updateTestInfo('None', 'None', 'None');
                log('Player cleared');
                showStatus('Player cleared', 'success');
                
            } catch (error) {
                log(`Failed to clear player: ${error.message}`, 'error');
            }
        }

        // Check if video file exists
        async function checkVideoFile() {
            try {
                showStatus('Checking video file...', 'loading');
                log('üîç Comprehensive file accessibility check');
                
                const testUrls = [
                    'http://localhost:8080/content/input.mp4',
                    'http://localhost:8080/video_encrypted.mp4',
                    'http://localhost:8080/manifest.mpd',
                    'http://localhost:8080/player-config.json'
                ];
                
                let allGood = true;
                
                for (const url of testUrls) {
                    try {
                        log(`\nüìÅ Checking: ${url}`);
                        
                        // HEAD request to check availability
                        const headResponse = await fetch(url, { method: 'HEAD' });
                        if (headResponse.ok) {
                            const contentLength = headResponse.headers.get('content-length');
                            const contentType = headResponse.headers.get('content-type');
                            log(`  ‚úÖ Status: ${headResponse.status} ${headResponse.statusText}`);
                            log(`  üìè Size: ${contentLength ? `${contentLength} bytes` : 'Unknown'}`);
                            log(`  üìÑ Type: ${contentType || 'Unknown'}`);
                            
                            // For manifest, do additional checks
                            if (url.includes('manifest.mpd')) {
                                const getResponse = await fetch(url);
                                const manifestContent = await getResponse.text();
                                
                                log(`  üìã Manifest analysis:`);
                                log(`    - Length: ${manifestContent.length} characters`);
                                log(`    - Has CENC: ${manifestContent.includes('cenc') ? 'Yes' : 'No'}`);
                                log(`    - Has ContentProtection: ${manifestContent.includes('ContentProtection') ? 'Yes' : 'No'}`);
                                log(`    - Has KID: ${manifestContent.includes('default_KID') ? 'Yes' : 'No'}`);
                                
                                // Check UUID
                                if (manifestContent.includes('urn:uuid:e2719d58-a985-b3c9-781a-b030af78d30e')) {
                                    log(`    - DRM UUID: ClearKey (‚úÖ Correct)`);
                                } else if (manifestContent.includes('urn:uuid:')) {
                                    const uuidMatch = manifestContent.match(/urn:uuid:([a-f0-9-]+)/);
                                    log(`    - DRM UUID: ${uuidMatch ? uuidMatch[1] : 'Unknown'} (‚ùå Wrong)`);
                                    allGood = false;
                                } else {
                                    log(`    - DRM UUID: Not found (‚ùå Missing)`);
                                    allGood = false;
                                }
                                
                                // Extract and validate KID
                                const kidMatch = manifestContent.match(/cenc:default_KID="([^"]+)"/);
                                if (kidMatch) {
                                    const manifestKid = kidMatch[1];
                                    log(`    - Manifest KID: ${manifestKid}`);
                                    
                                    // Check format
                                    const hasDashes = manifestKid.includes('-');
                                    log(`    - KID format: ${hasDashes ? 'With dashes' : 'No dashes'}`);
                                    
                                    if (hasDashes) {
                                        log(`    - ‚ö†Ô∏è  Warning: ClearKey prefers KID without dashes`);
                                    }
                                }
                            }
                            
                            // For player config, validate keys
                            if (url.includes('player-config.json')) {
                                const getResponse = await fetch(url);
                                const config = await getResponse.json();
                                
                                log(`  üîë Player config analysis:`);
                                const keyCount = Object.keys(config.clearKeys || {}).length;
                                log(`    - Clear keys: ${keyCount}`);
                                
                                if (keyCount > 0) {
                                    for (const [kid, key] of Object.entries(config.clearKeys)) {
                                        log(`    - KID: ${kid} (${kid.length} chars)`);
                                        log(`    - Key: ${key} (${key.length} chars)`);
                                        
                                        const kidValid = /^[0-9a-f]{32}$/i.test(kid);
                                        const keyValid = /^[0-9a-f]{32}$/i.test(key);
                                        log(`    - Formats valid: KID=${kidValid}, Key=${keyValid}`);
                                        
                                        if (!kidValid || !keyValid) {
                                            allGood = false;
                                        }
                                    }
                                } else {
                                    log(`    - ‚ùå No clear keys found`);
                                    allGood = false;
                                }
                            }
                            
                        } else {
                            log(`  ‚ùå Not found: ${headResponse.status} ${headResponse.statusText}`, 'error');
                            allGood = false;
                        }
                    } catch (error) {
                        log(`  ‚ùå Error checking ${url}: ${error.message}`, 'error');
                        allGood = false;
                    }
                }
                
                log(`\nüéØ Overall assessment: ${allGood ? '‚úÖ All checks passed' : '‚ùå Issues found'}`);
                showStatus(`File check completed - ${allGood ? 'All good!' : 'Issues found, see log'}`, allGood ? 'success' : 'error');
                
                if (!allGood) {
                    log('\nüîß Recommended fixes:', 'error');
                    log('  1. Regenerate content: npm run package-video', 'error');
                    log('  2. Check manifest DRM UUID', 'error');
                    log('  3. Verify key formats', 'error');
                    log('  4. Restart servers', 'error');
                }
                
            } catch (error) {
                log(`File check failed: ${error.message}`, 'error');
                showStatus('File check failed', 'error');
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            log('Video test environment loaded');
            log('üí° Start with "Load Original Video" to test basic playback');
            showStatus('Ready! Start with unencrypted video to test basic playback.', 'success');
        });
    </script>
</body>
</html>